<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buy Scrap | ScrapCycle</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#1a1a1a',
            secondary: '#dc2626',
          }
        }
      }
    }
  </script>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col">
  <custom-navbar></custom-navbar>

  <main class="flex-grow container mx-auto px-4 py-8">
    <div class="flex flex-col md:flex-row gap-6">
      <!-- Filters -->
      <aside class="w-full md:w-64 bg-gray-800 p-4 rounded-lg h-fit sticky top-4">
        <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
          <i data-feather="filter"></i> Filters
        </h2>

        <div class="mb-4">
          <label class="block text-sm font-medium mb-2">Search</label>
          <div class="relative">
            <input type="text" placeholder="Aluminum, copper, etc." class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-secondary focus:border-transparent">
            <button class="absolute right-2 top-2 text-gray-400 hover:text-white">
              <i data-feather="search"></i>
            </button>
          </div>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium mb-2">Category</label>
          <select class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-secondary focus:border-transparent">
            <option>All Categories</option>
            <option>Aluminum</option>
            <option>Copper</option>
            <option>Steel</option>
            <option>Brass</option>
            <option>Electronics</option>
            <option>Batteries</option>
            <option>Automotive</option>
          </select>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium mb-2">Location</label>
          <input type="text" placeholder="City or ZIP" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-secondary focus:border-transparent">
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium mb-2">Price Range</label>
          <div class="flex items-center gap-2">
            <input type="number" placeholder="Min" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-secondary focus:border-transparent">
            <span>to</span>
            <input type="number" placeholder="Max" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-secondary focus:border-transparent">
          </div>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium mb-2">Sort By</label>
          <select class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-secondary focus:border-transparent">
            <option>Newest First</option>
            <option>Price: Low to High</option>
            <option>Price: High to Low</option>
            <option>Nearest First</option>
          </select>
        </div>

        <button class="w-full bg-secondary hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 flex items-center justify-center gap-2">
          <i data-feather="filter"></i> Apply Filters
        </button>
      </aside>

      <!-- Main Content -->
      <div class="flex-1">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
          <h1 class="text-3xl font-bold">Available Scrap Listings</h1>
          <div class="flex gap-2">
            <button class="bg-gray-800 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200 flex items-center gap-2">
              <i data-feather="map"></i> Map View
            </button>
            <button class="bg-gray-800 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200 flex items-center gap-2">
              <i data-feather="grid"></i> Grid View
            </button>
          </div>
        </div>

        <!-- Listing Cards -->
        <div id="listingsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      </div>
    </div>
  </main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

  // ğŸ”¥ Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
  const firebaseConfig = {
  apiKey: "AIzaSyDhhczCSH9yOHubM4CDPLJWBEwOec2Z2uY",
  authDomain: "lbhi-fd609.firebaseapp.com",
  projectId: "lbhi-fd609",
  storageBucket: "lbhi-fd609.firebasestorage.app",
  messagingSenderId: "1098419098489",
  appId: "1:1098419098489:web:58cb18ae9db214d6d715a8",
  measurementId: "G-RE086FFMNV"
};

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ğŸ“¦ Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  async function loadListings() {
    const listingsContainer = document.getElementById("listingsContainer");
    listingsContainer.innerHTML = "<p class='text-gray-400'>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª...</p>";

    try {
      const snapshot = await getDocs(collection(db, "listings"));
      listingsContainer.innerHTML = "";

      if (snapshot.empty) {
        listingsContainer.innerHTML = "<p class='text-gray-400 text-center'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>";
        return;
      }
// ğŸ§  ÙÙ„ØªØ±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
async function applyFilters() {
  const searchInput = document.querySelector("input[placeholder='Aluminum, copper, etc.']").value.toLowerCase();
  const categorySelect = document.querySelector("select").value;
  const minPrice = parseFloat(document.querySelectorAll("input[type='number']")[0].value) || 0;
  const maxPrice = parseFloat(document.querySelectorAll("input[type='number']")[1].value) || Infinity;

  const listingsContainer = document.getElementById("listingsContainer");
  listingsContainer.innerHTML = "<p class='text-gray-400'>Ø¬Ø§Ø±ÙŠ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±...</p>";

  try {
    const snapshot = await getDocs(collection(db, "listings"));
    listingsContainer.innerHTML = "";

    let filteredListings = [];
    snapshot.forEach((doc) => {
      const data = doc.data();

      // ğŸ” ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø´Ø±ÙˆØ·
      const matchesSearch =
        data.title.toLowerCase().includes(searchInput) ||
        data.description.toLowerCase().includes(searchInput);

      const matchesCategory =
        categorySelect === "All Categories" || data.scrapType === categorySelect;

      const price = parseFloat(data.price);
      const matchesPrice = price >= minPrice && price <= maxPrice;

      if (matchesSearch && matchesCategory && matchesPrice) {
        filteredListings.push({ id: doc.id, ...data });
      }
    });

    if (filteredListings.length === 0) {
      listingsContainer.innerHTML = "<p class='text-gray-400 text-center'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ÙÙ„Ø§ØªØ±.</p>";
      return;
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ÙÙ„ØªØ±Ø©
    filteredListings.forEach((data) => {
      const image = data.images?.[0] || "https://via.placeholder.com/300x200?text=No+Image";
      const card = `
        <div class="bg-gray-800 rounded-lg overflow-hidden transition duration-200 hover:shadow-lg hover:shadow-secondary/20">
          <img src="${image}" alt="${data.title}" class="w-full h-48 object-cover">
          <div class="p-4">
            <h3 class="text-xl font-bold mb-2">${data.title}</h3>
            <p class="text-gray-400 mb-3">${data.description}</p>
            <div class="flex justify-between items-center">
              <span class="text-secondary font-bold">${data.price} Ø¯.Ø¬</span>
              <a href="listing-details.html?id=${data.id}" 
                 class="bg-secondary hover:bg-red-700 text-white py-1 px-3 rounded-lg text-sm transition">Ø§Ù„ØªÙØ§ØµÙŠÙ„</a>
            </div>
          </div>
        </div>
      `;
      listingsContainer.innerHTML += card;
    });
  } catch (error) {
    console.error("âš ï¸ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙÙ„ØªØ±Ø©:", error);
    listingsContainer.innerHTML = "<p class='text-red-500 text-center'>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙÙ„ØªØ±Ø©.</p>";
  }
}

// ğŸ¯ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙ„ØªØ±Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Apply Filters"
document.querySelector("button.bg-secondary").addEventListener("click", applyFilters);

      snapshot.forEach((doc) => {
        const data = doc.data();
        const image = data.images?.[0] || "https://via.placeholder.com/300x200?text=No+Image";
        const card = `
          <div class="bg-gray-800 rounded-lg overflow-hidden transition duration-200 hover:shadow-lg hover:shadow-secondary/20">
            <img src="${image}" alt="${data.title}" class="w-full h-48 object-cover">
            <div class="p-4">
              <h3 class="text-xl font-bold mb-2">${data.title}</h3>
              <p class="text-gray-400 mb-3">${data.description}</p>
              <div class="flex justify-between items-center">
                <span class="text-secondary font-bold">${data.price} Ø¯.Ø¬</span>
                <a href="listing-details.html?id=${doc.id}" 
                   class="bg-secondary hover:bg-red-700 text-white py-1 px-3 rounded-lg text-sm transition">Ø§Ù„ØªÙØ§ØµÙŠÙ„</a>
              </div>
            </div>
          </div>
        `;
        listingsContainer.innerHTML += card;
      });
    } catch (error) {
      console.error("âš ï¸ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª:", error);
      listingsContainer.innerHTML = "<p class='text-red-500 text-center'>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª.</p>";
    }
  }

  document.addEventListener("DOMContentLoaded", loadListings);
</script>

</body>
</html>
