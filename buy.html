<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buy Scrap | ScrapCycle</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#f8fafc',
            secondary: '#facc15',
            accent: '#1e3a8a',
            card: '#ffffff',
            border: '#e2e8f0'
          }
        }
      }
    }
  </script>
</head>

<body class="bg-primary text-gray-900 min-h-screen flex flex-col">
  <custom-navbar></custom-navbar>

  <main class="flex-grow container mx-auto px-4 py-8">
    <div class="flex flex-col md:flex-row gap-6">
      
      <!-- Filters -->
      <aside class="w-full md:w-64 bg-card border border-border p-4 rounded-lg h-fit sticky top-4 shadow-md">
        <h2 class="text-xl font-bold mb-4 flex items-center gap-2 text-accent">
          <i data-feather="filter"></i> Ø§Ù„ÙÙ„Ø§ØªØ±
        </h2>

        <div class="mb-4">
          <label class="block text-sm font-medium mb-2 text-gray-700">Ø¨Ø­Ø«</label>
          <div class="relative">
            <input id="searchInput" type="text" placeholder="Ø£Ù„Ù…Ù†ÙŠÙˆÙ…ØŒ Ù†Ø­Ø§Ø³ØŒ Ø¥Ù„Ø®..." class="w-full bg-white border border-border rounded-lg px-4 py-2 focus:ring-2 focus:ring-secondary focus:border-transparent text-gray-800 placeholder-gray-400">
            <button class="absolute right-2 top-2 text-accent hover:text-yellow-600">
              <i data-feather="search"></i>
            </button>
          </div>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium mb-2 text-gray-700">Ø§Ù„ÙØ¦Ø©</label>
          <select id="categorySelect" class="w-full bg-white border border-border rounded-lg px-4 py-2 focus:ring-2 focus:ring-secondary text-gray-800">
            <option>ÙƒÙ„ Ø§Ù„ÙØ¦Ø§Øª</option>
            <option>Ø£Ù„Ù…Ù†ÙŠÙˆÙ…</option>
            <option>Ù†Ø­Ø§Ø³</option>
            <option>ÙÙˆÙ„Ø§Ø°</option>
            <option>Ù†Ø­Ø§Ø³ Ø£ØµÙØ±</option>
            <option>Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
            <option>Ø¨Ø·Ø§Ø±ÙŠØ§Øª</option>
            <option>Ø³ÙŠØ§Ø±Ø§Øª</option>
          </select>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium mb-2 text-gray-700">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
          <input id="locationInput" type="text" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠ" class="w-full bg-white border border-border rounded-lg px-4 py-2 focus:ring-2 focus:ring-secondary text-gray-800 placeholder-gray-400">
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium mb-2 text-gray-700">Ù†Ø·Ø§Ù‚ Ø§Ù„Ø³Ø¹Ø±</label>
          <div class="flex items-center gap-2">
            <input id="minPrice" type="number" placeholder="Ø§Ù„Ø£Ø¯Ù†Ù‰" class="w-full bg-white border border-border rounded-lg px-4 py-2 focus:ring-2 focus:ring-secondary text-gray-800 placeholder-gray-400">
            <span>-</span>
            <input id="maxPrice" type="number" placeholder="Ø§Ù„Ø£Ø¹Ù„Ù‰" class="w-full bg-white border border-border rounded-lg px-4 py-2 focus:ring-2 focus:ring-secondary text-gray-800 placeholder-gray-400">
          </div>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium mb-2 text-gray-700">Ø§Ù„ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨</label>
          <select id="sortSelect" class="w-full bg-white border border-border rounded-lg px-4 py-2 focus:ring-2 focus:ring-secondary text-gray-800">
            <option>Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</option>
            <option>Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰</option>
            <option>Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø£Ù‚Ù„</option>
          </select>
        </div>

        <button id="applyFilters" class="w-full bg-secondary hover:bg-yellow-400 text-gray-900 font-bold py-2 px-4 rounded-lg transition duration-300 flex items-center justify-center gap-2 shadow hover:scale-105">
          <i data-feather="filter"></i> ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±
        </button>
      </aside>

      <!-- Main Content -->
      <div class="flex-1">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
          <h1 class="text-3xl font-bold text-accent">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©</h1>
          <div class="flex gap-2">
            <button class="bg-white border border-border hover:bg-gray-100 text-gray-800 font-medium py-2 px-4 rounded-lg transition duration-300 flex items-center gap-2 hover:scale-105">
              <i data-feather="map"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
            </button>
            <button class="bg-white border border-border hover:bg-gray-100 text-gray-800 font-medium py-2 px-4 rounded-lg transition duration-300 flex items-center gap-2 hover:scale-105">
              <i data-feather="grid"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø¨ÙƒØ©
            </button>
          </div>
        </div>

        <!-- Listing Cards -->
        <div id="listingsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      </div>
    </div>
  </main>

  <script>
    feather.replace();
  </script>

  <!-- âœ… Firebase with filter logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDhhczCSH9yOHubM4CDPLJWBEwOec2Z2uY",
      authDomain: "lbhi-fd609.firebaseapp.com",
      projectId: "lbhi-fd609",
      storageBucket: "lbhi-fd609.firebasestorage.app",
      messagingSenderId: "1098419098489",
      appId: "1:1098419098489:web:58cb18ae9db214d6d715a8",
      measurementId: "G-RE086FFMNV"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const listingsContainer = document.getElementById("listingsContainer");

    function displayListing(data, id) {
      const image = data.images?.[0] || "https://via.placeholder.com/300x200?text=No+Image";
      return `
        <div class="bg-card border border-border rounded-lg overflow-hidden hover:shadow-lg transition duration-200">
          <img src="${image}" alt="${data.title}" class="w-full h-48 object-cover">
          <div class="p-4">
            <h3 class="text-xl font-bold mb-2 text-accent">${data.title}</h3>
           
            <div class="flex justify-between items-center">
              <span class="text-secondary font-bold text-lg">${data.price} Ø¯.Ø¬</span>
              <a href="listing-details.html?id=${id}" 
                 class="bg-secondary hover:bg-yellow-400 text-gray-900 py-1 px-3 rounded-lg text-sm font-medium transition">Ø§Ù„ØªÙØ§ØµÙŠÙ„</a>
            </div>
          </div>
        </div>
      `;
    }

    // ğŸ§  ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
    async function loadListings() {
      listingsContainer.innerHTML = "<p class='text-gray-500'>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª...</p>";
      const snapshot = await getDocs(collection(db, "listings"));
      listingsContainer.innerHTML = "";
      if (snapshot.empty) {
        listingsContainer.innerHTML = "<p class='text-gray-500 text-center'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>";
        return;
      }
      snapshot.forEach(doc => {
        listingsContainer.innerHTML += displayListing(doc.data(), doc.id);
      });
    }

    // ğŸ§© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±
    async function applyFilters() {
      const searchValue = document.getElementById("searchInput").value.toLowerCase();
      const categoryValue = document.getElementById("categorySelect").value;
      const locationValue = document.getElementById("locationInput").value.toLowerCase();
      const minPrice = parseFloat(document.getElementById("minPrice").value) || 0;
      const maxPrice = parseFloat(document.getElementById("maxPrice").value) || Infinity;
      const sortValue = document.getElementById("sortSelect").value;

      listingsContainer.innerHTML = "<p class='text-gray-500'>Ø¬Ø§Ø±Ù ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±...</p>";

      const snapshot = await getDocs(collection(db, "listings"));
      listingsContainer.innerHTML = "";

      let filtered = [];
      snapshot.forEach(doc => {
        const data = doc.data();
        const price = parseFloat(data.price) || 0;

        const matchesSearch =
          data.title?.toLowerCase().includes(searchValue) ||
          data.description?.toLowerCase().includes(searchValue);

        const matchesCategory =
          categoryValue === "ÙƒÙ„ Ø§Ù„ÙØ¦Ø§Øª" || data.scrapType === categoryValue;

        const matchesLocation =
          !locationValue || data.location?.toLowerCase().includes(locationValue);

        const matchesPrice = price >= minPrice && price <= maxPrice;

        if (matchesSearch && matchesCategory && matchesLocation && matchesPrice) {
          filtered.push({ id: doc.id, ...data });
        }
      });

      // ğŸ”¢ Ø§Ù„ØªØ±ØªÙŠØ¨
      if (sortValue === "Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰") {
        filtered.sort((a, b) => a.price - b.price);
      } else if (sortValue === "Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø£Ù‚Ù„") {
        filtered.sort((a, b) => b.price - a.price);
      }

      if (filtered.length === 0) {
        listingsContainer.innerHTML = "<p class='text-gray-500 text-center'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©.</p>";
        return;
      }

      filtered.forEach(item => {
        listingsContainer.innerHTML += displayListing(item, item.id);
      });
    }

    // âš™ï¸ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    document.addEventListener("DOMContentLoaded", loadListings);
    document.getElementById("applyFilters").addEventListener("click", applyFilters);
  </script>
</body>
</html>
